<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Which Spain is calling you?</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
  <!-- Start Experience Button Overlay - Appears first -->
  <div id="startExperienceOverlay" class="start-experience-overlay">
    <div class="start-experience-container">
      <img
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEguNKXZxOtkRuwNziT13vSJ6GHJ9RCnf0tsHxwYUQ1ejz8a-lhk64Mxdp37YZv4AI1D-4agnAWwda4h6c-SjjjON9trtkbUE7sYMELWC-1ajm-Uc0uSOyYeInugn0dETZPUsogaklni-D8/s0/Flag_of_Spain.gif"
        alt="Spain Flag" class="start-flag">
      <h1 class="start-title">Which Spain is calling you?</h1>
      <p class="start-subtitle">An interactive map to discover your perfect Spanish city</p>
      <button id="startExperienceBtn" class="start-experience-btn">
        ğŸµ Start Experience
      </button>
      <p class="start-note">Click to enable audio and begin</p>
    </div>
  </div>

  <!-- Map Section -->
  <section id="mapSection">
    <!-- Incoming Call Overlay - Now inside map section -->
    <div id="callOverlay" class="call-overlay-popup">
      <div class="call-phone">
        <button id="closeCallOverlay" class="close-popup-btn" title="Close">âœ•</button>
        <p class="incoming">ğŸ“ Incoming callâ€¦</p>
        <h2>Spain</h2>
        <p class="subtitle">Which Spain is calling you?</p>

        <div class="call-actions">
          <button id="declineCall" class="call-btn decline">âœ–</button>
          <button id="answerCall" class="call-btn answer">ğŸ“</button>
        </div>
      </div>
    </div>

    <!-- Intro Explanation Modal - Now inside map section -->
    <div id="introModal" class="intro-modal-popup">
      <div class="intro-content">
        <button id="closeIntro" class="modal-close">âœ•</button>
        <h2>ğŸ‘‹ Hola, this is Spain calling</h2>

        <p>
          This map helps you compare Spanish cities using a single composite index,
          built from multiple social, economic and environmental indicators.
        </p>

        <h3>ğŸ“Š How the index works</h3>
        <p>
          All variables were <strong>normalised</strong> to a common scale (1-10), allowing
          very different indicators to be compared and combined fairly.
        </p>

        <ul>
          <li>
            <strong>Directly proportional criteria</strong><br>
            Higher values = better score
            <em>(e.g. income potential, life expectancy, quality of water)</em>
          </li>
          <li>
            <strong>Inversely proportional criteria</strong><br>
            Higher values = worse score
            <em>(e.g. crime rate, pollution, cost burdens)</em>
          </li>
        </ul>

        <p>
          After normalisation, your selected criteria are weighted and combined into
          a single index that determines each point size and color on the map. If you
          want to learn more about the sources and methodology, you can acess the 
          Methodology and Sources button located in the left lower area of the map.
        </p>

        <p class="closing">
          In short: you choose what matters â€” the platform reccommends you the best cities
          for your specific case.
        </p>
      </div>
    </div>

    <div id="legend">
      <!-- City Search Box -->
      <div id="citySearchContainer">
        <input type="text" id="citySearchInput" placeholder="ğŸ” Search for a city..." autocomplete="off">
        <div id="citySearchResults"></div>
      </div>

      <!-- Legend Header - Mobile Friendly -->
      <div class="legend-header">
        <img
          src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEguNKXZxOtkRuwNziT13vSJ6GHJ9RCnf0tsHxwYUQ1ejz8a-lhk64Mxdp37YZv4AI1D-4agnAWwda4h6c-SjjjON9trtkbUE7sYMELWC-1ajm-Uc0uSOyYeInugn0dETZPUsogaklni-D8/s0/Flag_of_Spain.gif"
          alt="Spain" class="flag-icon">
        <h2 class="legend-title">Which Spain is calling you?</h2>
      </div>

      <!-- Legend Description - Can be hidden on mobile -->
      <p class="legend-description">A tool to decide where to travel or where to migrate!âœˆï¸</p>
      
      <!-- Credits - Can be hidden on mobile -->
      <p class="credits legend-credits">
        By: <strong>Igor Dolgov</strong> and <strong>Ricardo Ontaneda</strong><br>
        <span class="credits-subtitle">EMJM Cartography MSc.</span>
      </p>

      <!-- Methodology Button -->
      <button id="methodologyBtn" class="methodology-btn" title="View Methodology & Sources">
        <span class="methodology-icon">ğŸ“Š</span>
        <span class="methodology-label">Methodology & Sources</span>
      </button>

      <!-- Data Table Button -->
      <button id="dataTableBtn" class="methodology-btn" title="View City Rankings & Data" style="display: none;">
        <span class="methodology-icon">ğŸ“‹</span>
        <span class="methodology-label">View Data Table</span>
      </button>

      <!-- Legend Note -->
      <p class="legend-note">Cities are sized and colored based on <b>your own preferences</b></p>
    </div>

    <!-- Zoom Controls -->
    <div id="zoomControls" class="map-hidden">
      <button id="zoomInBtn" class="zoom-btn" title="Zoom In">+</button>
      <button id="zoomResetBtn" class="zoom-btn" title="Reset Zoom">âŠ™</button>
      <button id="zoomOutBtn" class="zoom-btn" title="Zoom Out">âˆ’</button>
    </div>

    <!-- Right Sidebar for Criteria Selection -->
    <div id="criteriaPanel">
      <button id="togglePanelBtn" class="toggle-panel-btn" title="Minimize/Maximize Panel">
        <span id="toggleIcon">â—€</span>
      </button>

      <div id="panelContent">
        <div class="panel-header">
          <h3>ğŸ¯ Define Your Priorities</h3>
          <p class="panel-subtitle"><b>Click on each checkbox</b> to select criteria and <b>scroll down</b> to adjust weights</p>

          <!-- Tourist / Migrant Filter Toggle -->
          <div class="filter-toggle">
            <label class="filter-option">
              <input type="radio" name="userType" value="migrant" checked>
              <span>ğŸ  Migrant</span>
            </label>
            <label class="filter-option">
              <input type="radio" name="userType" value="tourist">
              <span>âœˆï¸ Tourist</span>
            </label>
          </div>

          <!-- Season Selector (only visible for tourists) -->
          <div id="seasonSelector" class="season-selector" style="display: none;">
            <label class="season-label">ğŸŒ¤ï¸ Select Season:</label>
            <select id="seasonSelect" class="season-select">
              <option value="spring">ğŸŒ¸ Spring</option>
              <option value="summer" selected>â˜€ï¸ Summer</option>
              <option value="fall">ğŸ‚ Fall</option>
              <option value="winter">â„ï¸ Winter</option>
            </select>
          </div>
        </div>

        <div class="panel-section">
          <h4>Select Criteria (max 5)</h4>
          <div id="criteriaCheckboxList"></div>
        </div>

        <div class="panel-section" id="weightsSection" style="display: none;">
          <h4>Adjust Weights</h4>
          <div id="criteriaWeightsList"></div>
          <button class="action-button" id="updateMapBtn">Update Map</button>
        </div>
      </div>
    </div>

    <div id="mapContainer"></div>

    <!-- City Detail View (hidden by default) -->
    <div id="cityDetailView" style="display: none;">
      <div id="cityDetailHeader">
        <h2 id="cityDetailTitle"></h2>
        <button id="backToMapBtn" class="back-btn">â† Back to Spain Map</button>
      </div>

      <!-- City Zoom Controls -->
      <div id="cityZoomControls">
        <button id="cityZoomInBtn" class="zoom-btn" title="Zoom In">+</button>
        <button id="cityZoomResetBtn" class="zoom-btn" title="Reset Zoom">âŠ™</button>
        <button id="cityZoomOutBtn" class="zoom-btn" title="Zoom Out">âˆ’</button>
      </div>

      <div id="cityDetailMapContainer"></div>
    </div>

    <!-- Methodology Modal -->
    <div id="methodologyModal" class="modal" style="display: none;">
      <div class="modal-content">
        <button id="closeMethodologyBtn" class="modal-close">âœ•</button>
        <h1 class="modal-title">ğŸ“Š Methodology & Data Sources</h1>
        <p class="modal-subtitle">Learn how we process and analyze data for each criterion</p>

        <div id="methodologyContent" class="methodology-grid">
          <!-- Content will be dynamically loaded -->
        </div>
      </div>
    </div>

    <!-- Data Table Modal -->
    <div id="dataTableModal" class="modal" style="display: none;">
      <div class="modal-content data-table-modal-content">
        <button id="closeDataTableBtn" class="modal-close">âœ•</button>
        <div class="data-table-header">
          <h1 class="modal-title">ğŸ“‹ City Rankings & Data</h1>
          <p class="modal-subtitle">Explore detailed rankings based on your selected criteria</p>
          <div class="table-info">
            <span id="tableInfoCriteria"></span>
            <span id="tableInfoCities"></span>
          </div>
        </div>

        <div id="dataTableContainer" class="data-table-container">
          <table id="cityDataTable" class="city-data-table">
            <thead id="tableHead">
              <!-- Headers will be dynamically generated -->
            </thead>
            <tbody id="tableBody">
              <!-- Data rows will be dynamically generated -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>

  <!-- Load map script -->
  <script src="mapping-script.js"></script>

</body>

</html>
