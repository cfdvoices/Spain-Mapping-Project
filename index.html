<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Which Spain is calling you?</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
  <!-- Start Experience Button Overlay - Appears first -->
  <div id="startExperienceOverlay" class="start-experience-overlay">
    <div class="start-experience-container">
      <img
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEguNKXZxOtkRuwNziT13vSJ6GHJ9RCnf0tsHxwYUQ1ejz8a-lhk64Mxdp37YZv4AI1D-4agnAWwda4h6c-SjjjON9trtkbUE7sYMELWC-1ajm-Uc0uSOyYeInugn0dETZPUsogaklni-D8/s0/Flag_of_Spain.gif"
        alt="Spain Flag" class="start-flag">
      <h1 class="start-title">Which Spain is calling you?</h1>
      <p class="start-subtitle">An interactive map to discover your perfect Spanish city</p>
      <button id="startExperienceBtn" class="start-experience-btn">
        ğŸµ Start Experience
      </button>
      <p class="start-note">Click to enable audio and begin</p>
    </div>
  </div>

  <!-- Map Section -->
  <section id="mapSection">
    <!-- Incoming Call Overlay - Now inside map section -->
    <div id="callOverlay" class="call-overlay-popup">
      <div class="call-phone">
        <button id="closeCallOverlay" class="close-popup-btn" title="Close">âœ•</button>
        <p class="incoming">ğŸ“ Incoming callâ€¦</p>
        <h2>Spain</h2>
        <p class="subtitle">Which Spain is calling you?</p>

        <div class="call-actions">
          <button id="declineCall" class="call-btn decline">âœ–</button>
          <button id="answerCall" class="call-btn answer">ğŸ“</button>
        </div>
      </div>
    </div>

    <!-- Intro Explanation Modal - Now inside map section -->
    <div id="introModal" class="intro-modal-popup">
      <div class="intro-content">
        <button id="closeIntro" class="modal-close">âœ•</button>
        <h2>ğŸ‘‹ Hola, this is Spain calling</h2>

        <p>
          This map helps you compare Spanish cities using a single composite index,
          built from multiple social, economic and environmental indicators.
        </p>

        <h3>ğŸ“Š How the index works</h3>
        <p>
          All variables were <strong>normalised</strong> to a common scale, allowing
          very different indicators to be compared and combined fairly.
        </p>

        <ul>
          <li>
            <strong>Directly proportional variables</strong><br>
            Higher values = better score
            <em>(e.g. income potential, accessibility, services)</em>
          </li>
          <li>
            <strong>Inversely proportional variables</strong><br>
            Higher values = worse score
            <em>(e.g. crime rate, pollution, cost burdens)</em>
          </li>
        </ul>

        <p>
          After normalisation, your selected criteria are weighted and combined into
          a single index that determines each city's size and colour on the map.
        </p>

        <p class="closing">
          In short: you choose what matters â€” Spain does the maths.
        </p>
      </div>
    </div>

    <div id="legend">
      <!-- City Search Box -->
      <div id="citySearchContainer">
        <input type="text" id="citySearchInput" placeholder="ğŸ” Search for a city..." autocomplete="off">
        <div id="citySearchResults"></div>
      </div>

      <h2>
        <img
          src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEguNKXZxOtkRuwNziT13vSJ6GHJ9RCnf0tsHxwYUQ1ejz8a-lhk64Mxdp37YZv4AI1D-4agnAWwda4h6c-SjjjON9trtkbUE7sYMELWC-1ajm-Uc0uSOyYeInugn0dETZPUsogaklni-D8/s0/Flag_of_Spain.gif"
          alt="Spain" class="flag-icon" alignment="centered"><br>
        <br>Which Spain is calling you?
      </h2>
      <p>A tool to decide where to travel or where to migrate!âœˆï¸</p>
      <p class="credits">By: <strong>Igor Dolgov</strong> and <strong>Ricardo Ontaneda</strong><br>EMJM Cartography MSc.
      </p>
      <br>
      <button id="methodologyBtn" class="methodology-btn" title="View Methodology & Sources">
        <span class="methodology-icon">ğŸ“Š</span>
        <span class="methodology-label">Methodology & Sources</span>
      </button>
      <p>Cities are sized and colored based on <b>your own preferences</b></p>
    </div>

    <!-- Zoom Controls -->
    <div id="zoomControls" class="map-hidden">
      <button id="zoomInBtn" class="zoom-btn" title="Zoom In">+</button>
      <button id="zoomResetBtn" class="zoom-btn" title="Reset Zoom">âŠ™</button>
      <button id="zoomOutBtn" class="zoom-btn" title="Zoom Out">âˆ’</button>
    </div>

    <!-- Right Sidebar for Criteria Selection -->
    <div id="criteriaPanel">
      <button id="togglePanelBtn" class="toggle-panel-btn" title="Minimize/Maximize Panel">
        <span id="toggleIcon">â–¶</span>
      </button>

      <div id="panelContent">
        <div class="panel-header">
          <h3>ğŸ¯ Define Your Priorities</h3>
          <p class="panel-subtitle"><b>Click on each checkbox</b> to select criteria and <b>scroll down</b> to adjust weights</p>

          <!-- Tourist / Migrant Filter Toggle -->
          <div class="filter-toggle">
            <label class="filter-option">
              <input type="radio" name="userType" value="migrant" checked>
              <span>ğŸ  Migrant</span>
            </label>
            <label class="filter-option">
              <input type="radio" name="userType" value="tourist">
              <span>âœˆï¸ Tourist</span>
            </label>
          </div>
        </div>

        <div class="panel-section">
          <h4>Select Criteria (max 5)</h4>
          <div id="criteriaCheckboxList"></div>
        </div>

        <div class="panel-section" id="weightsSection" style="display: none;">
          <h4>Adjust Weights</h4>
          <div id="criteriaWeightsList"></div>
          <button class="action-button" id="updateMapBtn">Update Map</button>
        </div>
      </div>
    </div>

    <div id="mapContainer"></div>

    <!-- City Detail View (hidden by default) -->
    <div id="cityDetailView" style="display: none;">
      <div id="cityDetailHeader">
        <h2 id="cityDetailTitle"></h2>
        <button id="backToMapBtn" class="back-btn">â† Back to Spain Map</button>
      </div>

      <!-- City Zoom Controls -->
      <div id="cityZoomControls">
        <button id="cityZoomInBtn" class="zoom-btn" title="Zoom In">+</button>
        <button id="cityZoomResetBtn" class="zoom-btn" title="Reset Zoom">âŠ™</button>
        <button id="cityZoomOutBtn" class="zoom-btn" title="Zoom Out">âˆ’</button>
      </div>

      <div id="cityDetailMapContainer"></div>
    </div>

    <!-- Methodology Modal -->
    <div id="methodologyModal" class="modal" style="display: none;">
      <div class="modal-content">
        <button id="closeMethodologyBtn" class="modal-close">âœ•</button>
        <h1 class="modal-title">ğŸ“Š Methodology & Data Sources</h1>
        <p class="modal-subtitle">Learn how we process and analyze data for each criterion</p>

        <div id="methodologyContent" class="methodology-grid">
          <!-- Content will be dynamically loaded -->
        </div>
      </div>
    </div>
  </section>

  <!-- Load map script -->
  <script src="mapping-script.js"></script>

</body>

</html>
